// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Business {
  business_id        String      @id @default(uuid())
  business_name      String
  business_address   String?
  business_phone_num String?     @db.VarChar(20)
  register_date      DateTime    @db.Date
  soft_opening_date  DateTime?   @db.Date
  close_date         DateTime?   @db.Date
  is_active          Boolean     @default(true)
  created_at         DateTime    @default(now())
  updated_at         DateTime    @default(now())

  menuItems          MenuItem[]
  menuCategories     MenuCategory[]
  orders             Order[]
}

model User {
  user_id      String   @id @default(uuid())
  user_name    String
  fullname     String
  email        String   @unique
  password_hash String
  role         String   @db.VarChar(50)
  is_active    Boolean  @default(true)
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
}

model MenuCategory {
  category_id   String      @id @default(uuid())
  business      Business    @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  business_id   String
  category_name String
  is_active     Boolean     @default(true)
  created_at    DateTime    @default(now())
  updated_at    DateTime    @default(now())

  menuItems     MenuItem[]

  @@index([business_id], name: "idx_category_business_id")
}

model MenuItem {
  item_id     String          @id @default(uuid())
  business    Business        @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  category    MenuCategory    @relation(fields: [category_id], references: [category_id], onDelete: Cascade)
  business_id String
  category_id String
  item_name   String
  description String?
  price       Decimal         
  image_url   String?
  is_available Boolean        @default(true)
  created_at  DateTime        @default(now())
  updated_at  DateTime        @default(now())

  options     MenuItemOption[]
  orderItems  OrderItem[]

  @@index([business_id], name: "idx_menu_item_business_id")
  @@index([category_id], name: "idx_menu_item_category_id")
  @@index([is_available], name: "idx_menu_item_is_available")
}

model MenuItemOption {
  option_id   String     @id @default(uuid())
  item        MenuItem   @relation(fields: [item_id], references: [item_id], onDelete: Cascade)
  item_id     String
  name        String
  price       Decimal    @default(0.0) 
  created_at  DateTime   @default(now())
  updated_at  DateTime   @default(now())

  orderItemOptions OrderItemOption[]

  @@index([item_id], name: "idx_menu_item_option_item_id")
}

model Order {
  order_id     String     @id @default(uuid())
  business     Business   @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  business_id  String
  table_id     String?
  customer_id  String?
  type         OrderType
  status       OrderStatus
  subtotal     Decimal    
  tax          Decimal    
  delivery_fee Decimal    @default(0.0) 
  discount     Decimal    @default(0.0) 
  grand_total  Decimal    
  created_at   DateTime   @default(now())
  updated_at   DateTime   @default(now())

  orderItems   OrderItem[]

  @@index([business_id], name: "idx_orders_business_id")
  @@index([status], name: "idx_orders_status")
  @@index([type], name: "idx_orders_type")
}

enum OrderType {
  dine_in
  delivery
}

enum OrderStatus {
  pending
  in_progress
  ready
  completed
  cancelled
}

model OrderItem {
  order_item_id String    @id @default(uuid())
  order         Order     @relation(fields: [order_id], references: [order_id], onDelete: Cascade)
  item          MenuItem  @relation(fields: [item_id], references: [item_id])
  order_id      String
  item_id       String
  item_name     String
  price         Decimal   
  quantity      Int       @default(1)
  note          String?
  created_at    DateTime  @default(now())
  updated_at    DateTime  @default(now())

  options       OrderItemOption[]

  @@index([order_id], name: "idx_order_item_order_id")
}

model OrderItemOption {
  id              String           @id @default(uuid())
  order_item      OrderItem        @relation(fields: [order_item_id], references: [order_item_id], onDelete: Cascade)
  option          MenuItemOption   @relation(fields: [option_id], references: [option_id])
  order_item_id   String
  option_id       String
  name            String
  price           Decimal          @default(0.0) 
  created_at      DateTime         @default(now())

  @@index([order_item_id], name: "idx_order_item_option_order_item_id")
}